# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Develop Env on merge

'on':
  pull_request:
    branches:
      - develop
    types: [closed]

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/checkout@v2
      - name: Install package and build
        run: npm install && npm ci && npm run build
      - name: Deploy
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_LAB_ASSIGNMENT_DEV }}'
          channelId: live
          projectId: lab-assignment-dev
  delete_preview_env:
    runs-on: ubuntu-latest
    steps:
      - name: delete preview
        uses: w9jds/firebase-action@master
        with:
          args: hosting:channel:delete ${{ github.event.number }} --project=${{ env.PROJECT_ID }} -f
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_LAB_ASSIGNMENT_DEV }}
          PROJECT_ID: lab-assignment-dev
